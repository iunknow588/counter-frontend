import ft,{PROPOSAL_EXPIRY_MESSAGE as mt}from"@walletconnect/sign-client";import{isValidObject as gt,isCaipNamespace as fe,parseNamespaceKey as U,mergeArrays as ee,parseChainId as me,getSdkError as ge,isValidArray as Pe}from"@walletconnect/utils";import{pino as Pt,getDefaultLoggerOptions as bt}from"@walletconnect/logger";import b,{HttpConnection as $t}from"@walletconnect/jsonrpc-http-connection";import{JsonRpcProvider as g}from"@walletconnect/jsonrpc-provider";import{formatJsonRpcRequest as yt,formatJsonRpcResult as wt}from"@walletconnect/jsonrpc-utils";import _t from"events";const be="error",Ct="wss://relay.walletconnect.org",It="wc",Ot="universal_provider",$e=`${It}@2:${Ot}:`,ye="https://rpc.walletconnect.org/v1/",w="generic",At=`${ye}bundler`,m={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jt(){this.__data__=[],this.size=0}var Ht=jt;function Et(r,e){return r===e||r!==r&&e!==e}var z=Et,St=z;function Nt(r,e){for(var t=r.length;t--;)if(St(r[t][0],e))return t;return-1}var k=Nt,Tt=k,Dt=Array.prototype,qt=Dt.splice;function Rt(r){var e=this.__data__,t=Tt(e,r);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():qt.call(e,t,1),--this.size,!0}var xt=Rt,Lt=k;function Ut(r){var e=this.__data__,t=Lt(e,r);return t<0?void 0:e[t][1]}var Mt=Ut,Ft=k;function Gt(r){return Ft(this.__data__,r)>-1}var zt=Gt,kt=k;function Bt(r,e){var t=this.__data__,i=kt(t,r);return i<0?(++this.size,t.push([r,e])):t[i][1]=e,this}var Vt=Bt,Jt=Ht,Kt=xt,Xt=Mt,Wt=zt,Yt=Vt;function _(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}_.prototype.clear=Jt,_.prototype.delete=Kt,_.prototype.get=Xt,_.prototype.has=Wt,_.prototype.set=Yt;var B=_,Zt=B;function Qt(){this.__data__=new Zt,this.size=0}var er=Qt;function tr(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var rr=tr;function ir(r){return this.__data__.get(r)}var sr=ir;function ar(r){return this.__data__.has(r)}var nr=ar,or=typeof G=="object"&&G&&G.Object===Object&&G,we=or,cr=we,hr=typeof self=="object"&&self&&self.Object===Object&&self,pr=cr||hr||Function("return this")(),C=pr,ur=C,lr=ur.Symbol,_e=lr,Ce=_e,Ie=Object.prototype,dr=Ie.hasOwnProperty,vr=Ie.toString,M=Ce?Ce.toStringTag:void 0;function fr(r){var e=dr.call(r,M),t=r[M];try{r[M]=void 0;var i=!0}catch{}var s=vr.call(r);return i&&(e?r[M]=t:delete r[M]),s}var mr=fr,gr=Object.prototype,Pr=gr.toString;function br(r){return Pr.call(r)}var $r=br,Oe=_e,yr=mr,wr=$r,_r="[object Null]",Cr="[object Undefined]",Ae=Oe?Oe.toStringTag:void 0;function Ir(r){return r==null?r===void 0?Cr:_r:Ae&&Ae in Object(r)?yr(r):wr(r)}var V=Ir;function Or(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var $=Or,Ar=V,jr=$,Hr="[object AsyncFunction]",Er="[object Function]",Sr="[object GeneratorFunction]",Nr="[object Proxy]";function Tr(r){if(!jr(r))return!1;var e=Ar(r);return e==Er||e==Sr||e==Hr||e==Nr}var te=Tr,Dr=C,qr=Dr["__core-js_shared__"],Rr=qr,re=Rr,je=function(){var r=/[^.]+$/.exec(re&&re.keys&&re.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function xr(r){return!!je&&je in r}var Lr=xr,Ur=Function.prototype,Mr=Ur.toString;function Fr(r){if(r!=null){try{return Mr.call(r)}catch{}try{return r+""}catch{}}return""}var Gr=Fr,zr=te,kr=Lr,Br=$,Vr=Gr,Jr=/[\\^$.*+?()[\]{}|]/g,Kr=/^\[object .+?Constructor\]$/,Xr=Function.prototype,Wr=Object.prototype,Yr=Xr.toString,Zr=Wr.hasOwnProperty,Qr=RegExp("^"+Yr.call(Zr).replace(Jr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ei(r){if(!Br(r)||kr(r))return!1;var e=zr(r)?Qr:Kr;return e.test(Vr(r))}var ti=ei;function ri(r,e){return r?.[e]}var ii=ri,si=ti,ai=ii;function ni(r,e){var t=ai(r,e);return si(t)?t:void 0}var ie=ni,oi=ie,ci=C,hi=oi(ci,"Map"),He=hi,pi=ie,ui=pi(Object,"create"),J=ui,Ee=J;function li(){this.__data__=Ee?Ee(null):{},this.size=0}var di=li;function vi(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var fi=vi,mi=J,gi="__lodash_hash_undefined__",Pi=Object.prototype,bi=Pi.hasOwnProperty;function $i(r){var e=this.__data__;if(mi){var t=e[r];return t===gi?void 0:t}return bi.call(e,r)?e[r]:void 0}var yi=$i,wi=J,_i=Object.prototype,Ci=_i.hasOwnProperty;function Ii(r){var e=this.__data__;return wi?e[r]!==void 0:Ci.call(e,r)}var Oi=Ii,Ai=J,ji="__lodash_hash_undefined__";function Hi(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Ai&&e===void 0?ji:e,this}var Ei=Hi,Si=di,Ni=fi,Ti=yi,Di=Oi,qi=Ei;function I(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}I.prototype.clear=Si,I.prototype.delete=Ni,I.prototype.get=Ti,I.prototype.has=Di,I.prototype.set=qi;var Ri=I,Se=Ri,xi=B,Li=He;function Ui(){this.size=0,this.__data__={hash:new Se,map:new(Li||xi),string:new Se}}var Mi=Ui;function Fi(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Gi=Fi,zi=Gi;function ki(r,e){var t=r.__data__;return zi(e)?t[typeof e=="string"?"string":"hash"]:t.map}var K=ki,Bi=K;function Vi(r){var e=Bi(this,r).delete(r);return this.size-=e?1:0,e}var Ji=Vi,Ki=K;function Xi(r){return Ki(this,r).get(r)}var Wi=Xi,Yi=K;function Zi(r){return Yi(this,r).has(r)}var Qi=Zi,es=K;function ts(r,e){var t=es(this,r),i=t.size;return t.set(r,e),this.size+=t.size==i?0:1,this}var rs=ts,is=Mi,ss=Ji,as=Wi,ns=Qi,os=rs;function O(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var i=r[e];this.set(i[0],i[1])}}O.prototype.clear=is,O.prototype.delete=ss,O.prototype.get=as,O.prototype.has=ns,O.prototype.set=os;var cs=O,hs=B,ps=He,us=cs,ls=200;function ds(r,e){var t=this.__data__;if(t instanceof hs){var i=t.__data__;if(!ps||i.length<ls-1)return i.push([r,e]),this.size=++t.size,this;t=this.__data__=new us(i)}return t.set(r,e),this.size=t.size,this}var vs=ds,fs=B,ms=er,gs=rr,Ps=sr,bs=nr,$s=vs;function A(r){var e=this.__data__=new fs(r);this.size=e.size}A.prototype.clear=ms,A.prototype.delete=gs,A.prototype.get=Ps,A.prototype.has=bs,A.prototype.set=$s;var ys=A,ws=ie,_s=function(){try{var r=ws(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Ne=_s,Te=Ne;function Cs(r,e,t){e=="__proto__"&&Te?Te(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var se=Cs,Is=se,Os=z;function As(r,e,t){(t!==void 0&&!Os(r[e],t)||t===void 0&&!(e in r))&&Is(r,e,t)}var De=As;function js(r){return function(e,t,i){for(var s=-1,a=Object(e),n=i(e),o=n.length;o--;){var c=n[r?o:++s];if(t(a[c],c,a)===!1)break}return e}}var Hs=js,Es=Hs,Ss=Es(),Ns=Ss,ae={exports:{}};(function(r,e){var t=C,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,a=s&&s.exports===i,n=a?t.Buffer:void 0,o=n?n.allocUnsafe:void 0;function c(u,l){if(l)return u.slice();var P=u.length,d=o?o(P):new u.constructor(P);return u.copy(d),d}r.exports=c})(ae,ae.exports);var Ts=C,Ds=Ts.Uint8Array,qs=Ds,qe=qs;function Rs(r){var e=new r.constructor(r.byteLength);return new qe(e).set(new qe(r)),e}var xs=Rs,Ls=xs;function Us(r,e){var t=e?Ls(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var Ms=Us;function Fs(r,e){var t=-1,i=r.length;for(e||(e=Array(i));++t<i;)e[t]=r[t];return e}var Gs=Fs,zs=$,Re=Object.create,ks=function(){function r(){}return function(e){if(!zs(e))return{};if(Re)return Re(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),Bs=ks;function Vs(r,e){return function(t){return r(e(t))}}var Js=Vs,Ks=Js,Xs=Ks(Object.getPrototypeOf,Object),xe=Xs,Ws=Object.prototype;function Ys(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Ws;return r===t}var Le=Ys,Zs=Bs,Qs=xe,ea=Le;function ta(r){return typeof r.constructor=="function"&&!ea(r)?Zs(Qs(r)):{}}var ra=ta;function ia(r){return r!=null&&typeof r=="object"}var F=ia,sa=V,aa=F,na="[object Arguments]";function oa(r){return aa(r)&&sa(r)==na}var ca=oa,Ue=ca,ha=F,Me=Object.prototype,pa=Me.hasOwnProperty,ua=Me.propertyIsEnumerable,la=Ue(function(){return arguments}())?Ue:function(r){return ha(r)&&pa.call(r,"callee")&&!ua.call(r,"callee")},Fe=la,da=Array.isArray,Ge=da,va=9007199254740991;function fa(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=va}var ze=fa,ma=te,ga=ze;function Pa(r){return r!=null&&ga(r.length)&&!ma(r)}var ne=Pa,ba=ne,$a=F;function ya(r){return $a(r)&&ba(r)}var wa=ya,X={exports:{}};function _a(){return!1}var Ca=_a;(function(r,e){var t=C,i=Ca,s=e&&!e.nodeType&&e,a=s&&!0&&r&&!r.nodeType&&r,n=a&&a.exports===s,o=n?t.Buffer:void 0,c=o?o.isBuffer:void 0,u=c||i;r.exports=u})(X,X.exports);var Ia=V,Oa=xe,Aa=F,ja="[object Object]",Ha=Function.prototype,Ea=Object.prototype,ke=Ha.toString,Sa=Ea.hasOwnProperty,Na=ke.call(Object);function Ta(r){if(!Aa(r)||Ia(r)!=ja)return!1;var e=Oa(r);if(e===null)return!0;var t=Sa.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&ke.call(t)==Na}var Da=Ta,qa=V,Ra=ze,xa=F,La="[object Arguments]",Ua="[object Array]",Ma="[object Boolean]",Fa="[object Date]",Ga="[object Error]",za="[object Function]",ka="[object Map]",Ba="[object Number]",Va="[object Object]",Ja="[object RegExp]",Ka="[object Set]",Xa="[object String]",Wa="[object WeakMap]",Ya="[object ArrayBuffer]",Za="[object DataView]",Qa="[object Float32Array]",en="[object Float64Array]",tn="[object Int8Array]",rn="[object Int16Array]",sn="[object Int32Array]",an="[object Uint8Array]",nn="[object Uint8ClampedArray]",on="[object Uint16Array]",cn="[object Uint32Array]",p={};p[Qa]=p[en]=p[tn]=p[rn]=p[sn]=p[an]=p[nn]=p[on]=p[cn]=!0,p[La]=p[Ua]=p[Ya]=p[Ma]=p[Za]=p[Fa]=p[Ga]=p[za]=p[ka]=p[Ba]=p[Va]=p[Ja]=p[Ka]=p[Xa]=p[Wa]=!1;function hn(r){return xa(r)&&Ra(r.length)&&!!p[qa(r)]}var pn=hn;function un(r){return function(e){return r(e)}}var ln=un,oe={exports:{}};(function(r,e){var t=we,i=e&&!e.nodeType&&e,s=i&&!0&&r&&!r.nodeType&&r,a=s&&s.exports===i,n=a&&t.process,o=function(){try{var c=s&&s.require&&s.require("util").types;return c||n&&n.binding&&n.binding("util")}catch{}}();r.exports=o})(oe,oe.exports);var dn=pn,vn=ln,Be=oe.exports,Ve=Be&&Be.isTypedArray,fn=Ve?vn(Ve):dn,Je=fn;function mn(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var Ke=mn,gn=se,Pn=z,bn=Object.prototype,$n=bn.hasOwnProperty;function yn(r,e,t){var i=r[e];(!($n.call(r,e)&&Pn(i,t))||t===void 0&&!(e in r))&&gn(r,e,t)}var wn=yn,_n=wn,Cn=se;function In(r,e,t,i){var s=!t;t||(t={});for(var a=-1,n=e.length;++a<n;){var o=e[a],c=i?i(t[o],r[o],o,t,r):void 0;c===void 0&&(c=r[o]),s?Cn(t,o,c):_n(t,o,c)}return t}var On=In;function An(r,e){for(var t=-1,i=Array(r);++t<r;)i[t]=e(t);return i}var jn=An,Hn=9007199254740991,En=/^(?:0|[1-9]\d*)$/;function Sn(r,e){var t=typeof r;return e=e??Hn,!!e&&(t=="number"||t!="symbol"&&En.test(r))&&r>-1&&r%1==0&&r<e}var Xe=Sn,Nn=jn,Tn=Fe,Dn=Ge,qn=X.exports,Rn=Xe,xn=Je,Ln=Object.prototype,Un=Ln.hasOwnProperty;function Mn(r,e){var t=Dn(r),i=!t&&Tn(r),s=!t&&!i&&qn(r),a=!t&&!i&&!s&&xn(r),n=t||i||s||a,o=n?Nn(r.length,String):[],c=o.length;for(var u in r)(e||Un.call(r,u))&&!(n&&(u=="length"||s&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Rn(u,c)))&&o.push(u);return o}var Fn=Mn;function Gn(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var zn=Gn,kn=$,Bn=Le,Vn=zn,Jn=Object.prototype,Kn=Jn.hasOwnProperty;function Xn(r){if(!kn(r))return Vn(r);var e=Bn(r),t=[];for(var i in r)i=="constructor"&&(e||!Kn.call(r,i))||t.push(i);return t}var Wn=Xn,Yn=Fn,Zn=Wn,Qn=ne;function eo(r){return Qn(r)?Yn(r,!0):Zn(r)}var We=eo,to=On,ro=We;function io(r){return to(r,ro(r))}var so=io,Ye=De,ao=ae.exports,no=Ms,oo=Gs,co=ra,Ze=Fe,Qe=Ge,ho=wa,po=X.exports,uo=te,lo=$,vo=Da,fo=Je,et=Ke,mo=so;function go(r,e,t,i,s,a,n){var o=et(r,t),c=et(e,t),u=n.get(c);if(u){Ye(r,t,u);return}var l=a?a(o,c,t+"",r,e,n):void 0,P=l===void 0;if(P){var d=Qe(c),Q=!d&&po(c),ve=!d&&!Q&&fo(c);l=c,d||Q||ve?Qe(o)?l=o:ho(o)?l=oo(o):Q?(P=!1,l=ao(c,!0)):ve?(P=!1,l=no(c,!0)):l=[]:vo(c)||Ze(c)?(l=o,Ze(o)?l=mo(o):(!lo(o)||uo(o))&&(l=co(c))):P=!1}P&&(n.set(c,l),s(l,c,i,a,n),n.delete(c)),Ye(r,t,l)}var Po=go,bo=ys,$o=De,yo=Ns,wo=Po,_o=$,Co=We,Io=Ke;function tt(r,e,t,i,s){r!==e&&yo(e,function(a,n){if(s||(s=new bo),_o(a))wo(r,e,n,t,tt,i,s);else{var o=i?i(Io(r,n),a,n+"",r,e,s):void 0;o===void 0&&(o=a),$o(r,n,o)}},Co)}var Oo=tt;function Ao(r){return r}var rt=Ao;function jo(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var Ho=jo,Eo=Ho,it=Math.max;function So(r,e,t){return e=it(e===void 0?r.length-1:e,0),function(){for(var i=arguments,s=-1,a=it(i.length-e,0),n=Array(a);++s<a;)n[s]=i[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=i[s];return o[e]=t(n),Eo(r,this,o)}}var No=So;function To(r){return function(){return r}}var Do=To,qo=Do,st=Ne,Ro=rt,xo=st?function(r,e){return st(r,"toString",{configurable:!0,enumerable:!1,value:qo(e),writable:!0})}:Ro,Lo=xo,Uo=800,Mo=16,Fo=Date.now;function Go(r){var e=0,t=0;return function(){var i=Fo(),s=Mo-(i-t);if(t=i,s>0){if(++e>=Uo)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var zo=Go,ko=Lo,Bo=zo,Vo=Bo(ko),Jo=Vo,Ko=rt,Xo=No,Wo=Jo;function Yo(r,e){return Wo(Xo(r,e,Ko),r+"")}var Zo=Yo,Qo=z,ec=ne,tc=Xe,rc=$;function ic(r,e,t){if(!rc(t))return!1;var i=typeof e;return(i=="number"?ec(t)&&tc(e,t.length):i=="string"&&e in t)?Qo(t[e],r):!1}var sc=ic,ac=Zo,nc=sc;function oc(r){return ac(function(e,t){var i=-1,s=t.length,a=s>1?t[s-1]:void 0,n=s>2?t[2]:void 0;for(a=r.length>3&&typeof a=="function"?(s--,a):void 0,n&&nc(t[0],t[1],n)&&(a=s<3?void 0:a,s=1),e=Object(e);++i<s;){var o=t[i];o&&r(e,o,i,a)}return e})}var cc=oc,hc=Oo,pc=cc,uc=pc(function(r,e,t){hc(r,e,t)}),lc=uc,dc=Object.defineProperty,vc=Object.defineProperties,fc=Object.getOwnPropertyDescriptors,at=Object.getOwnPropertySymbols,mc=Object.prototype.hasOwnProperty,gc=Object.prototype.propertyIsEnumerable,nt=(r,e,t)=>e in r?dc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,W=(r,e)=>{for(var t in e||(e={}))mc.call(e,t)&&nt(r,t,e[t]);if(at)for(var t of at(e))gc.call(e,t)&&nt(r,t,e[t]);return r},Pc=(r,e)=>vc(r,fc(e));function v(r,e,t){var i;const s=me(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${ye}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function y(r){return r.includes(":")?r.split(":")[1]:r}function ot(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function bc(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const a=e.namespaces[s].accounts;i.push(...a)}),i}function ce(r={},e={}){const t=ct(r),i=ct(e);return lc(t,i)}function ct(r){var e,t,i,s;const a={};if(!gt(r))return a;for(const[n,o]of Object.entries(r)){const c=fe(n)?[n]:o.chains,u=o.methods||[],l=o.events||[],P=o.rpcMap||{},d=U(n);a[d]=Pc(W(W({},a[d]),o),{chains:ee(c,(e=a[d])==null?void 0:e.chains),methods:ee(u,(t=a[d])==null?void 0:t.methods),events:ee(l,(i=a[d])==null?void 0:i.events),rpcMap:W(W({},P),(s=a[d])==null?void 0:s.rpcMap)})}return a}function $c(r){return r.includes(":")?r.split(":")[2]:r}function ht(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],a=i.events||[],n=i.accounts||[],o=fe(t)?[t]:i.chains?i.chains:ot(i.accounts);e[t]={chains:o,methods:s,events:a,accounts:n}}return e}function he(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const pt={},h=r=>pt[r],pe=(r,e)=>{pt[r]=e};var yc=Object.defineProperty,wc=(r,e,t)=>e in r?yc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,j=(r,e,t)=>wc(r,typeof e!="symbol"?e+"":e,t);class _c{constructor(e){j(this,"name","polkadot"),j(this,"client"),j(this,"httpProviders"),j(this,"events"),j(this,"namespace"),j(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new b(i,h("disableProviderPing")))}}var Cc=Object.defineProperty,Ic=Object.defineProperties,Oc=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertySymbols,Ac=Object.prototype.hasOwnProperty,jc=Object.prototype.propertyIsEnumerable,ue=(r,e,t)=>e in r?Cc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lt=(r,e)=>{for(var t in e||(e={}))Ac.call(e,t)&&ue(r,t,e[t]);if(ut)for(var t of ut(e))jc.call(e,t)&&ue(r,t,e[t]);return r},dt=(r,e)=>Ic(r,Oc(e)),H=(r,e,t)=>ue(r,typeof e!="symbol"?e+"":e,t);class Hc{constructor(e){H(this,"name","eip155"),H(this,"client"),H(this,"chainId"),H(this,"namespace"),H(this,"httpProviders"),H(this,"events"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||v(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new $t(i,h("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(y(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const a=parseInt(s,16);if(this.isChainApproved(a))this.setDefaultChain(`${a}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${a}`);else throw new Error(`Failed to switch to chain 'eip155:${a}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s;const a=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const n=this.client.session.get(e.topic),o=((s=n?.sessionProperties)==null?void 0:s.capabilities)||{};if(o!=null&&o[a])return o?.[a];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:dt(lt({},n.sessionProperties||{}),{capabilities:dt(lt({},o||{}),{[a]:c})})})}catch(u){console.warn("Failed to update session with capabilities",u)}return c}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),a=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(a){const o=this.getBundlerUrl(e.chainId,a);try{return await this.getUserOperationReceipt(o,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,o)}}const n=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(n)try{return await this.getUserOperationReceipt(n,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,n)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(yt("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!a.ok)throw new Error(`Failed to fetch user operation receipt - ${a.status}`);return await a.json()}getBundlerUrl(e,t){return`${At}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var Ec=Object.defineProperty,Sc=(r,e,t)=>e in r?Ec(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E=(r,e,t)=>Sc(r,typeof e!="symbol"?e+"":e,t);class Nc{constructor(e){E(this,"name","solana"),E(this,"client"),E(this,"httpProviders"),E(this,"events"),E(this,"namespace"),E(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new b(i,h("disableProviderPing")))}}var Tc=Object.defineProperty,Dc=(r,e,t)=>e in r?Tc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e,t)=>Dc(r,typeof e!="symbol"?e+"":e,t);class qc{constructor(e){S(this,"name","cosmos"),S(this,"client"),S(this,"httpProviders"),S(this,"events"),S(this,"namespace"),S(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new b(i,h("disableProviderPing")))}}var Rc=Object.defineProperty,xc=(r,e,t)=>e in r?Rc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,N=(r,e,t)=>xc(r,typeof e!="symbol"?e+"":e,t);class Lc{constructor(e){N(this,"name","algorand"),N(this,"client"),N(this,"httpProviders"),N(this,"events"),N(this,"namespace"),N(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||v(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new g(new b(i,h("disableProviderPing")))}}var Uc=Object.defineProperty,Mc=(r,e,t)=>e in r?Uc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,T=(r,e,t)=>Mc(r,typeof e!="symbol"?e+"":e,t);class Fc{constructor(e){T(this,"name","cip34"),T(this,"client"),T(this,"httpProviders"),T(this,"events"),T(this,"namespace"),T(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=y(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new b(i,h("disableProviderPing")))}}var Gc=Object.defineProperty,zc=(r,e,t)=>e in r?Gc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,D=(r,e,t)=>zc(r,typeof e!="symbol"?e+"":e,t);class kc{constructor(e){D(this,"name","elrond"),D(this,"client"),D(this,"httpProviders"),D(this,"events"),D(this,"namespace"),D(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new b(i,h("disableProviderPing")))}}var Bc=Object.defineProperty,Vc=(r,e,t)=>e in r?Bc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,q=(r,e,t)=>Vc(r,typeof e!="symbol"?e+"":e,t);class Jc{constructor(e){q(this,"name","multiversx"),q(this,"client"),q(this,"httpProviders"),q(this,"events"),q(this,"namespace"),q(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=y(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new b(i,h("disableProviderPing")))}}var Kc=Object.defineProperty,Xc=(r,e,t)=>e in r?Kc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,R=(r,e,t)=>Xc(r,typeof e!="symbol"?e+"":e,t);class Wc{constructor(e){R(this,"name","near"),R(this,"client"),R(this,"httpProviders"),R(this,"events"),R(this,"namespace"),R(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||v(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace);return typeof i>"u"?void 0:new g(new b(i,h("disableProviderPing")))}}var Yc=Object.defineProperty,Zc=(r,e,t)=>e in r?Yc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,x=(r,e,t)=>Zc(r,typeof e!="symbol"?e+"":e,t);class Qc{constructor(e){x(this,"name","tezos"),x(this,"client"),x(this,"httpProviders"),x(this,"events"),x(this,"namespace"),x(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||v(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace);return typeof i>"u"?void 0:new g(new b(i))}}var eh=Object.defineProperty,th=(r,e,t)=>e in r?eh(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,L=(r,e,t)=>th(r,typeof e!="symbol"?e+"":e,t);class rh{constructor(e){L(this,"name",w),L(this,"client"),L(this,"httpProviders"),L(this,"events"),L(this,"namespace"),L(this,"chainId"),this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const a=me(s);i[`${a.namespace}:${a.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||v(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new g(new b(i,h("disableProviderPing")))}}var ih=Object.defineProperty,sh=Object.defineProperties,ah=Object.getOwnPropertyDescriptors,vt=Object.getOwnPropertySymbols,nh=Object.prototype.hasOwnProperty,oh=Object.prototype.propertyIsEnumerable,le=(r,e,t)=>e in r?ih(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Y=(r,e)=>{for(var t in e||(e={}))nh.call(e,t)&&le(r,t,e[t]);if(vt)for(var t of vt(e))oh.call(e,t)&&le(r,t,e[t]);return r},de=(r,e)=>sh(r,ah(e)),f=(r,e,t)=>le(r,typeof e!="symbol"?e+"":e,t);class Z{constructor(e){f(this,"client"),f(this,"namespaces"),f(this,"optionalNamespaces"),f(this,"sessionProperties"),f(this,"events",new _t),f(this,"rpcProviders",{}),f(this,"session"),f(this,"providerOpts"),f(this,"logger"),f(this,"uri"),f(this,"shouldAbortPairingAttempt",!1),f(this,"maxPairingAttempts",10),f(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Pt(bt({level:e?.logger||be})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new Z(e);return await t.initialize(),t}async request(e,t,i){const[s,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Y({},e),chainId:`${s}:${a}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const a=new Date().getTime();this.request(e,i,s).then(n=>t(null,wt(a,n))).catch(n=>t(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ge("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const a=await s();if(this.session=a.session,this.session){const n=ht(this.session.namespaces);this.namespaces=ce(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:i,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});i&&(this.uri=i,this.events.emit("display_uri",i)),await s().then(a=>{this.session=a;const n=ht(a.namespaces);this.namespaces=ce(this.namespaces,n),this.persist("namespaces",this.namespaces)}).catch(a=>{if(a.message!==mt)throw a;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),a=this.getProvider(i);a.name===w?a.setDefaultChain(`${i}:${s}`,t):a.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Pe(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ft.init({core:this.providerOpts.core,logger:this.providerOpts.logger||be,relayUrl:this.providerOpts.relayUrl||Ct,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>U(t)))];pe("client",this.client),pe("events",this.events),pe("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=bc(t,this.session),s=ot(i),a=ce(this.namespaces,this.optionalNamespaces),n=de(Y({},a[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new Hc({namespace:n});break;case"algorand":this.rpcProviders[t]=new Lc({namespace:n});break;case"solana":this.rpcProviders[t]=new Nc({namespace:n});break;case"cosmos":this.rpcProviders[t]=new qc({namespace:n});break;case"polkadot":this.rpcProviders[t]=new _c({namespace:n});break;case"cip34":this.rpcProviders[t]=new Fc({namespace:n});break;case"elrond":this.rpcProviders[t]=new kc({namespace:n});break;case"multiversx":this.rpcProviders[t]=new Jc({namespace:n});break;case"near":this.rpcProviders[t]=new Wc({namespace:n});break;case"tezos":this.rpcProviders[t]=new Qc({namespace:n});break;default:this.rpcProviders[w]?this.rpcProviders[w].updateNamespace(n):this.rpcProviders[w]=new rh({namespace:n})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;if(i.name==="accountsChanged"){const s=i.data;s&&Pe(s)&&this.events.emit("accountsChanged",s.map($c))}else if(i.name==="chainChanged"){const s=t.chainId,a=t.event.data,n=U(s),o=he(s)!==he(a)?`${n}:${he(a)}`:s;this.onChainChanged(o)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,a=(i=this.client)==null?void 0:i.session.get(e);this.session=de(Y({},a),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",de(Y({},ge("USER_DISCONNECTED")),{data:e.topic}))}),this.on(m.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[w]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",i)}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(n=>U(n)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=U(Object.keys(this.namespaces)[0]),a=this.rpcProviders[s].getDefaultChain();return[s,a]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(t||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces[`${i}:${s}`]?this.namespaces[`${i}:${s}`].defaultChain=s:this.namespaces[`${i}:${s}`]={defaultChain:s},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${$e}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${$e}/${e}`)}}const ch=Z;export{ch as UniversalProvider,Z as default};
//# sourceMappingURL=index.es.js.map
